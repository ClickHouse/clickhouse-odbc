language: cpp

sudo: required
dist: trusty

os: linux

compiler:
  - gcc
#  - clang

cache:
  ccache: true

addons:
  apt:
    sources: [ ubuntu-toolchain-r-test, llvm-toolchain-trusty ]
    packages: [ gcc-7, g++-7, ninja-build, clang-5.0 ]


# TODO:
env:
    - MATRIX_EVAL="export UNICODE=0 && export CC=clang-5.0 && export CXX=clang++-5.0"
    - MATRIX_EVAL="export UNICODE=0 && export CC=gcc-7 && CXX=g++-7"
    - MATRIX_EVAL="export UNICODE=1 && export CC=clang-5.0 && export CXX=clang++-5.0"
    - MATRIX_EVAL="export UNICODE=1 && export CC=gcc-7 && CXX=g++-7"

#matrix:
#  include:
#    - compiler: ": gcc-7"
#      before_install:
#        - export CC="gcc-7" CXX="g++-7"
#    - compiler: ": clang-5.0"
#      before_install:
#        - export CC="clang-5.0" CXX="clang++-5.0"
#
#  exclude:
#    - compiler: gcc

install:
  - sudo apt-add-repository "deb http://archive.ubuntu.com/ubuntu artful main universe"
  - sudo apt-get update -q > build.log 2>&1 || (cat build.log && exit 1)
  - sudo apt-get install -y unixodbc-dev libssl-dev binutils libpoco-dev | tee build.log 2>&1 || (cat build.log && exit 1)

before_script:
    - eval "${MATRIX_EVAL}"

script:
  - mkdir -p build
  - cd build
  - cmake .. -G Ninja -DUNICODE=$UNICODE -DCMAKE_CXX_COMPILER=`which $CXX` -DCMAKE_C_COMPILER=`which $CC` && ninja all && ninja test
