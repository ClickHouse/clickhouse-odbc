name: Release
# - Download artifacts generated by other workflows
# - repack those
# - Set as github release artifacts

on:
  tags:
    - v*
  # For debugging only, remove before merging
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  release:
    types:
      - created

jobs:
  release:
    steps:
    - name: Set env
      run: |
      ARTIFACTS_PATH=${{runner.temp}}/artifacts
    - name: Get artifacts
      uses: actions/download-artifact@v3
      with:
        path: ${ARTIFACTS_PATH}

    - name: List artifacts
      run: |
        ls -AR -lah ${ARTIFACTS_PATH}
        exit -1

    - name: Upload artifacts as release assets
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        file: $ARTIFACTS_PATH
        overwrite: true
        tag: ${{ github.ref }}
        file_glob: true